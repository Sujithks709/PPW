<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Image to Perforation DXF</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body.dark-mode {
            background-color: #121212;
            color: white;
        }
        #previewContainer {
            overflow: hidden;
            width: 100%;
            height: 400px;
            border: 1px solid #ddd;
        }
        .grid {
            background: url('grid.png');
        }
    </style>
</head>
<body>
    <div class="container mt-4">
        <h2 class="text-center">Perforation DXF Generator</h2>

        <!-- Input Controls -->
        <div class="row">
            <div class="col-md-4">
                <label for="area_width">Width (mm):</label>
                <input type="number" id="area_width" class="form-control" value="500">
            </div>
            <div class="col-md-4">
                <label for="area_height">Height (mm):</label>
                <input type="number" id="area_height" class="form-control" value="500">
            </div>
            <div class="col-md-4">
                <button id="generateDXF" class="btn btn-primary mt-4">Generate DXF</button>
            </div>
        </div>

        <!-- Preview -->
        <div class="text-center mt-4">
            <h3>Live Preview (Zoom & Pan Enabled)</h3>
            <div id="previewContainer">
                <img id="previewImage" class="img-fluid" src="" alt="Perforation Preview">
            </div>
            <button id="toggleDarkMode" class="btn btn-secondary mt-3">Dark Mode</button>
            <input type="checkbox" id="toggleGrid"> Show Grid
            <a id="downloadPreview" class="btn btn-info mt-3" download="preview.png">Download Preview (PNG)</a>
        </div>
    </div>

    <script>
        document.getElementById("generateDXF").addEventListener("click", function() {
            let width = document.getElementById("area_width").value;
            let height = document.getElementById("area_height").value;

            fetch("/generate_dxf", {
                method: "POST",
                body: JSON.stringify({ width: width, height: height }),
                headers: { "Content-Type": "application/json" }
            })
            .then(response => response.blob())
            .then(blob => {
                let url = window.URL.createObjectURL(blob);
                let a = document.createElement("a");
                a.href = url;
                a.download = "perforation.dxf";
                document.body.appendChild(a);
                a.click();
                document.body.removeChild(a);
            });
        });

        // Dark Mode Toggle
        document.getElementById("toggleDarkMode").addEventListener("click", function() {
            document.body.classList.toggle("dark-mode");
            localStorage.setItem("darkMode", document.body.classList.contains("dark-mode"));
        });

        if (localStorage.getItem("darkMode") === "true") {
            document.body.classList.add("dark-mode");
        }

        // Grid Toggle
        document.getElementById("toggleGrid").addEventListener("change", function() {
            document.getElementById("previewContainer").classList.toggle("grid", this.checked);
        });

        // Download Preview
        document.getElementById("downloadPreview").addEventListener("click", function() {
            let img = document.getElementById("previewImage").src;
            this.href = img;
        });
    </script>
</body>
</html>
